
2º Modulo de implementação de serviços 

Serviço DNS
Servicos de centralização de informações openldap 
Servidor de Email

Maquina gatewal - firewall, dhcp, proxy, vpn 

intranet - (dns master, apache 2)


DNS 

Principal objetivo e fazer a resolução de nomes
53/udp - consulta
cache - tem alguma resposta referente a requisição 
root-servers - São servidores dispoiveis de dns
ttl - determina por quanto tempo essa consulta vai ficar guardada detro do cache 20m 
o servidor dns determina 
Consulta recursiva - root-servers

-------------------------------------------------------------------------------------

instalação do bind9

apt install bind9 bind9utils dnsutils -y

isola o serviço dns - a camada de serviço evita alguns ataques de exploração, ganhar privilegios de escala isolar ele dentro de um diretorio especifico.

criar o diretorio - mkdir -pv /var/bind9/chroot
vim /etc/default/named - aponta para o serviço do dns para pegar as informações no diretorio 

dentro do arquivo alterar - -t /var/bind9/chroot

quando acontecer o problema de arquivo alterado - rm /etc/default/.named.swp

criando outros diretorios - mkdir -pv /var/bind9/chroot/{etc,dev,var/cache/bind,var/run/named}

-p - parents diretorio pai e filho 

shift + control + v para colar 

ls -l /etc/bind/*

named.conf - arquivo de configuração

Movendo o diretório bind para o chroot - mv /etc/bind /var/bind9/chroot/etc/

ln -s /var/bind9/chroot/etc/bind /etc/bind - criando um link para facilitar o acesso

cd /var/bind9/chroot/dev - 

criar dois dispositivos - null e random 
mknod - criar um dispositivo que vao ser utilizados pelo dns 
mknod null c 1 3 
mknod random c 1 8 




alterar a data - date 030810322023
timedatectl - 
ls -l /etc/localtime 

----------------------------------------------------------------------------

alterar a permissão chmod 660 /var/bind9/chroot/dev/*
id bind - ele sobe com essa essa conta quando o serviço do dns sobe 
chown bind:bind /var/bind9/chroot/etc/bind/rndc.key  /var/bind9/chroot/var/ -R - alterar o dono e grupo 
chmod 775 /var/bind9/chroot/var/ -R alterando a permissão da pasta 
cd /etc/init.d - tem alguns arquivos de serviços 
vim named
PIDFILE=/var/bind9/chroot/var/run/named/named/named.pif
systemctl status bind9
                 named 
tail -f /var/log/messages - arquivo de log 

vim /etc/apparmor.d/usr.sbin.named - configurar o appamor para que ele não bloqueie a permissaõ 

adiciona /var/bind9/chroot/etc/bind/** r,
/var/bind9/chroot/var/** rw,
/var/bind9/chroot/dev/** rw,

para colar e control + shift + v 

systemctl restart apparmor - reiniciar o serviço para concluir a configuração 

journalctl -xe 

named.conf chamado outros arquivos zone, local, options 

include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.default-zones";

tsig-keygen TRANSFER > tsig.key - criando a chave entre as maquinas para estabelecer a relação de confiança
debian 10 utiliza o md5 agora no 11 o sha para algoritimo 

dentro do arquivo colocar a instrução 

server 192.168.1.20 {
	keys {TRANSFER; };
};

scp -P 52020 tsig.key analista@192.168.1.20:/tmp/ - copiando o arquivo para a maquina datacenter 

mv /tmp/tsig.key /etc/bind/

vim /etc/bind/named.conf

git clone https://github.com/rogerramossilva/linuxforce

